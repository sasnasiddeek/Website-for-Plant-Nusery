(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{"3zNn":function(t,e,n){"use strict";n.d(e,"a",function(){return a}),n.d(e,"b",function(){return s});var r=n("LoAr"),o=n("xejr"),i=n("24h1"),a=r.Db({encapsulation:2,styles:[],data:{}});function s(t){return r.Zb(2,[r.Ob(null,0)],null,null)}r.Bb("modal-window-container",o.a,function(t){return r.Zb(0,[(t()(),r.Fb(0,16777216,null,null,1,"modal-window-container",[],null,null,null,s,a)),r.Eb(1,245760,null,0,o.a,[i.a,r.db,r.l,r.x],null,null)],function(t,e){t(e,1,0)},null)},{},{},["*"])},PDpc:function(t,e,n){"use strict";n.d(e,"a",function(){return C});var r=n("D57K"),o=n("g3Dv"),i=n("19Zn"),a=n("SKSx"),s=n("5xGT"),c=n("fQLH"),u=n("gQst"),p=n("iUUs"),h=n("d9YI"),d=n("AouM"),l=n("U3QC"),m=n("z5yO"),f=n("w1VY"),g=n("QoSw"),y=n("flPR"),v=n("ljsB"),b=n("sXdR"),C=function(t){function e(e,n,r,o){var i=t.call(this,n)||this;return i.ll=e,i.state=n,i.commandService=r,i.diagToViewport=o,i._indicators=[],i.addSource=new c.a,i.removeSource=new c.a,i.changeSource=new c.a,i}return r.d(e,t),e.prototype.initialize=function(){var t=this,e=this.state.changes("InterfaceControlState").pipe(Object(d.a)(function(e){return t.removeIndicators(),"edit"===e?t.initForEditor():t.initForViewer()}));this.subs.push(e.subscribe())},e.prototype.initForViewer=function(){var t=this;return Object(u.a)(this.addIndicators().pipe(Object(d.a)(function(){return t.handleClick()})),this.listenToViewportChanges().pipe(Object(b.lodashThrottle)(300,{leading:!1,trailing:!0}),Object(l.a)(function(){return t.updateIndicators()})))},e.prototype.initForEditor=function(){var t=this;return Object(u.a)(this.hyperlinkKeyEvent("keydown").pipe(Object(b.lodashThrottle)(300,{leading:!0,trailing:!1}),Object(d.a)(function(){return t.addIndicators()}),Object(d.a)(function(){return t.handleClick()})),this.hyperlinkKeyEvent("keyup").pipe(Object(l.a)(function(){return t.removeIndicators()})),this.listenToViewportChanges().pipe(Object(l.a)(function(){return t.removeIndicators()})))},e.prototype.updateIndicators=function(){var t=this;this._indicators.forEach(function(e){t.positionIndicator(e),t.changeSource.next(e)})},e.prototype.addIndicators=function(){var t=this;return this.ll.forCurrent(!0).getDiagramOnce().pipe(Object(l.a)(function(e){Object.keys(e.shapes).forEach(function(n){var r=e.shapes[n];r.getTextsWithHyperlinks().forEach(function(e){var n=new s.T(0,0,e.width,e.height),o=t.getPoint(r,e),c=new a.a(e,o),u=i.B.getPointOnText(n,e.alignX,e.alignY);c.regX=u.x,c.regY=u.y,c.rotation=r.transform?r.transform.angle:0,t.positionIndicator(c),t._indicators.push(c),t.addSource.next(c)})})}))},e.prototype.getPoint=function(t,e){var n;if(t.isConnector()){var r=t;n=i.B.getPointOnConnector(r,e)}else{var o=t;n=i.B.getPointOnShape(e.position,o.defaultBounds,o.transform)}return n},e.prototype.handleClick=function(){var t=this;if(this.indicators.length>0){var e=this.indicators.map(function(e){var n=e.children.map(function(e){return Object(p.a)(e,"click").pipe(Object(l.a)(function(){return t.dispatchHyperlinkCmd(e)}))});return u.a.apply(void 0,r.j(n))});return u.a.apply(void 0,r.j(e))}return Object(h.b)()},e.prototype.dispatchHyperlinkCmd=function(t){this.commandService.dispatch(v.a.hyperlinkNavigate,{link:t.value})},e.prototype.hyperlinkKeyEvent=function(t){return Object(p.a)(window,t).pipe(Object(m.a)(function(t){return t.keyCode===o.e.Command||t.keyCode===o.e.Control}))},e.prototype.positionIndicator=function(t){t.x=this.diagToViewport.x(t.origin.x),t.y=this.diagToViewport.y(t.origin.y);var e=this.state.get("DiagramZoomLevel");t.scaleX=e,t.scaleY=e},e.prototype.listenToViewportChanges=function(){return Object(u.a)(this.state.changes("DiagramPan"),this.state.changes("DiagramZoomLevel"))},e.prototype.removeIndicators=function(){for(;this._indicators.length>0;)this.removeSource.next(this._indicators.pop())},Object.defineProperty(e.prototype,"indicators",{get:function(){return this._indicators},enumerable:!0,configurable:!0}),e.prototype.createAddSource=function(){return this.addSource},e.prototype.createRemoveSource=function(){return this.removeSource},e.prototype.createChangeSource=function(){return this.changeSource},e=r.c([Object(y.a)(),r.f("design:paramtypes",[g.a,s.bb,s.q,f.a])],e)}(y.b)},f6YR:function(t,e,n){"use strict";var r=n("D57K"),o=n("5xGT"),i=n("hX56"),a=n("nsO7"),s=n("fQLH"),c=n("gQst"),u=n("pN2L"),p=n("iUUs"),h=n("d9YI"),d=n("U3QC"),l=n("AouM"),m=n("Jg5f"),f=n("lqvn"),g=n("HswR"),y=n("O6K7"),v=n("yn08"),b=n("w1VY"),C=n("Wpmq"),O=n("QoSw"),w=n("3+4Q"),S=n("flPR"),j=n("h1tj"),I=function(t){function e(e){var n=t.call(this)||this;return n.model=e,n.prepare(),n}return r.d(e,t),e.prototype.destroy=function(){},e.prototype.prepare=function(){var t=new j.Shape;t.graphics.clear(),t.graphics.beginFill(e.ICON_COLOR),t.graphics.beginStroke("#FFFFFF"),t.graphics.setStrokeStyle(2),t.graphics.drawCircle(0,0,15),t.graphics.endStroke(),t.graphics.endFill(),t.shadow=new j.Shadow("rgba(0, 0, 0, 0.25)",0,2,3),this.addChild(t);var n=new j.Bitmap('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="22.84" height="17.07"><path fill="rgb(255, 255, 255)" d="M22.84,7.46C22.84,3.34,17.73,0,11.42,0S0,3.34,0,7.46s5.11,7.46,11.42,7.46a17.57,17.57,0,0,0,3.21-.3l4.3,2.43a.17.17,0,0,0,.25-.15l0-3.95C21.42,11.59,22.84,9.63,22.84,7.46Z" /></svg>');n.scaleX=.8,n.scaleY=.8,n.x=-9,n.y=-6,this.addChild(n)},e.ICON_COLOR="#F39C12",e}(j.Container);n.d(e,"a",function(){return T});var T=function(t){function e(e,n,r,o,i,a){var c=t.call(this,n)||this;return c.ll=e,c.state=n,c.datastore=r,c.commandService=o,c.diagToViewport=i,c.viewToDiagram=a,c.addSource=new s.a,c.removeSource=new s.a,c.changeSource=new s.a,c.shapeComments={},c.diagramComments={},c}var n;return r.d(e,t),n=e,e.prototype.initialize=function(){var t=this;this.subs.push(this.state.changes("CurrentDiagram").pipe(Object(d.a)(function(){t.hideCommentThreadView(),t.removeAllIndicators()}),Object(l.a)(function(e){return t.listenToOpenPanelChanges().pipe(Object(l.a)(function(e){return e?Object(c.a)(t.listenToCommentChanges(),t.listenToViewportChanges(),t.listenToDiagramChanges(),t.listenToCreateEvents()):(t.hideCommentThreadView(),t.removeAllIndicators())}))})).subscribe())},Object.defineProperty(e.prototype,"indicators",{get:function(){return r.j(Object(a.values)(this.diagramComments),Object(a.flatten)(Object(a.values)(this.shapeComments).map(function(t){return Object(a.values)(t)})))},enumerable:!0,configurable:!0}),e.prototype.createAddSource=function(){return this.addSource},e.prototype.createRemoveSource=function(){return this.removeSource},e.prototype.createChangeSource=function(){return this.changeSource},Object.defineProperty(e.prototype,"locator",{get:function(){return this.ll.forCurrent(!0)},enumerable:!0,configurable:!0}),e.prototype.listenToOpenPanelChanges=function(){return this.state.changes(n.SIDEBAR_STATE_KEY).pipe(Object(m.a)(function(t){return t===n.SIDEBAR_STATE_VAL}),Object(f.a)())},e.prototype.listenToCommentChanges=function(){var t=this,e=this.state.get("CurrentDiagram");return Object(c.a)(this.datastore.findLatest(w.a,{diagramId:e}).pipe(Object(m.a)(function(t){return{type:"insert",docs:t}})),this.datastore.watch(w.a,{diagramId:e}).pipe(Object(g.a)(function(t){return t.docs?o.y.build({docs:w.a},t):Object(u.a)(t)}))).pipe(Object(d.a)(function(e){if("insert"===e.type)e.docs.filter(function(t){return!t.parentId&&!t.resolved}).forEach(function(e){return t.createCommentIndicator(e)});else if("update"===e.type){e.docs.filter(function(t){return t.resolved}).forEach(function(e){return t.removeCommentIndicator(e)})}}))},e.prototype.listenToViewportChanges=function(){var t=this;return Object(c.a)(this.state.changes("DiagramPan"),this.state.changes("DiagramZoomLevel")).pipe(Object(l.a)(function(){return t.locator.getDiagramOnce()}),Object(d.a)(function(e){return t.updateIndicatorPositions(e)}))},e.prototype.listenToDiagramChanges=function(){var t=this;return this.locator.getDiagramChanges().pipe(Object(d.a)(function(e){var n,o,i,a;if(e.split.shapes)try{for(var s=r.k(Object.keys(e.split.shapes)),c=s.next();!c.done;c=s.next()){var u=c.value;if(t.shapeComments[u])try{for(var p=r.k(Object.keys(t.shapeComments[u])),h=p.next();!h.done;h=p.next()){var d=h.value,l=t.shapeComments[u][d];t.positionShapeCommentIndicator(l,e.model.shapes[u]),t.changeSource.next(l)}}catch(m){i={error:m}}finally{try{h&&!h.done&&(a=p.return)&&a.call(p)}finally{if(i)throw i.error}}}}catch(f){n={error:f}}finally{try{c&&!c.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}}))},e.prototype.listenToCreateEvents=function(){var t=this;return Object(p.a)(this.indicatorLayer,y.b.CreateComment).pipe(Object(d.a)(function(e){t.showCommentThreadView(e.getShapeId(),e.getPosition()),t.switchToNormalState()}))},e.prototype.removeAllIndicators=function(){var t,e;try{for(var n=r.k(this.indicators),o=n.next();!o.done;o=n.next()){var i=o.value;this.removeSource.next(i),i.destroy()}}catch(a){t={error:a}}finally{try{o&&!o.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}return this.shapeComments={},this.diagramComments={},Object(h.b)()},e.prototype.updateIndicatorPositions=function(t){var e,n,o,i,a,s;try{for(var c=r.k(Object.keys(this.diagramComments)),u=c.next();!u.done;u=c.next()){var p=u.value,h=this.diagramComments[p];this.positionDiagramCommentIndicator(h),this.changeSource.next(h)}}catch(y){e={error:y}}finally{try{u&&!u.done&&(n=c.return)&&n.call(c)}finally{if(e)throw e.error}}try{for(var d=r.k(Object.keys(this.shapeComments)),l=d.next();!l.done;l=d.next()){var m=l.value;try{for(var f=r.k(Object.keys(this.shapeComments[m])),g=f.next();!g.done;g=f.next()){p=g.value,h=this.shapeComments[m][p];this.positionShapeCommentIndicator(h,t.shapes[m]),this.changeSource.next(h)}}catch(v){a={error:v}}finally{try{g&&!g.done&&(s=f.return)&&s.call(f)}finally{if(a)throw a.error}}}}catch(b){o={error:b}}finally{try{l&&!l.done&&(i=d.return)&&i.call(d)}finally{if(o)throw o.error}}},e.prototype.createCommentIndicator=function(t){t.shapeId?this.createShapeCommentIndicator(t):this.createDiagramCommentIndicator(t)},e.prototype.createDiagramCommentIndicator=function(t){if(!this.diagramComments[t.id]){var e=new I(t);this.positionDiagramCommentIndicator(e),this.setupCommentInteractions(e),this.diagramComments[t.id]=e,this.addSource.next(e)}},e.prototype.positionDiagramCommentIndicator=function(t){t.x=this.diagToViewport.x(t.model.locOnDiagram.x),t.y=this.diagToViewport.y(t.model.locOnDiagram.y)},e.prototype.createShapeCommentIndicator=function(t){var e=this;this.locator.getShapeOnce(t.shapeId).subscribe(function(n){if(e.shapeComments[t.shapeId]||(e.shapeComments[t.shapeId]={}),!e.shapeComments[t.shapeId][t.id]){var r=new I(t);e.positionShapeCommentIndicator(r,n),e.setupCommentInteractions(r),e.shapeComments[t.shapeId][t.id]=r,e.addSource.next(r)}})},e.prototype.positionShapeCommentIndicator=function(t,e){if(!e)return this.positionDiagramCommentIndicator(t);var n=o.P.onRect(t.model.locOnShape,e.defaultBounds,e.transform);t.x=this.diagToViewport.x(n.x),t.y=this.diagToViewport.y(n.y)},e.prototype.removeCommentIndicator=function(t){var e=this.indicators.find(function(e){return e.model.id===t.id});this.removeSource.next(e),this.hideCommentThreadView()},e.prototype.setupCommentInteractions=function(t){var e=this;this.subs.push(Object(p.a)(t,"click").subscribe(function(){var n=t.model,r={visible:!0,threadId:n.id,comments:[n]};e.state.set("CommentThreadData",r)}))},e.prototype.showCommentThreadView=function(t,e){var n={visible:!0,shapeId:t,position:{x:this.viewToDiagram.x(e.x),y:this.viewToDiagram.y(e.y)}};this.state.set("CommentThreadData",n)},e.prototype.switchToNormalState=function(){this.state.set("MouseControlState",v.b.Normal)},e.prototype.hideCommentThreadView=function(){this.state.set("CommentThreadData",{})},e.SIDEBAR_STATE_KEY="RightSidebarPanel",e.SIDEBAR_STATE_VAL="diagramcomments",e=n=r.c([Object(S.a)(),r.f("design:paramtypes",[O.a,o.bb,i.b,o.q,b.a,C.a])],e)}(S.b)},sXdR:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("nsO7"),o=n("LcNk");e.lodashThrottle=function(t,e){return void 0===e&&(e={leading:!0,trailing:!0}),function(n){return o.Observable.create(function(o){var i=r.throttle(o.next.bind(o),t,e),a=n.subscribe(function(t){return i(t)},function(t){return o.next(t)},function(){return o.complete()});return function(){a.unsubscribe()}})}}}}]);